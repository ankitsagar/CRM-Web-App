{% extends 'salesman/base.html' %}
{% load static %}
{% load latest_task %}

{% block content %}


    <div class="row mt-4">
        <div class="col-sm-12">
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} bg-{{ message.tags }}">
                        <!-- singular -->
                        <a class="close" data-dismiss="alert">Ã—</a>
                        {{ message|safe }}
                    </div>
                {% endfor %}
            {% endif %}
        </div>
        <div class="col-sm-8">
            <div class="card card-accent-info" id="task-details">
                <div class="card-header">
                    <strong>Task Details</strong>
                    {% if task.task_status == 0 %}
                        <div class="pull-right">
                            <button type="button" data-toggle="modal"
                                    data-target="#task-edit"
                                    class="btn btn-sm btn-ghost-primary">
                                <i class="icon-note"> </i>
                                Edit
                            </button>
                        </div>
                    {% endif %}
                </div>

                <div class="card-body">
                    <div class="form-group">
                        <label>Subject *</label>
                        <input type="text" class="form-control"
                               value="{{ task }}" disabled>
                    </div>

                    <div class="form-group">
                        <label>Due Date *</label>
                        <input type="text" class="form-control"
                               value="{{ task.due_date }}" disabled>
                    </div>

                    <div class="form-group">
                        <label>Task Description</label>
                        <textarea rows="2" class="form-control"
                                  id="task-description"
                                  name="task_desc"
                                  disabled>{{ task.task_description }}</textarea>
                    </div>
                    <div class="row">
                        <div class="form-group col-sm-4">
                            <label>Priority</label>
                            <input type="text" class="form-control text-black-50    "
                                   value="{{ task.get_priority_display }}"
                                   disabled>

                        </div>

                        <div class="form-group col-sm-4">
                            <label>Status</label>
                            <input type="text"
                                   class="form-control"
                                   value="{{ task.get_task_status_display }}"
                                   disabled>

                        </div>

                        <div class="form-group col-sm-4">
                            <label>Owner</label>
                            <input type="text" class="form-control"
                                   value="{{ task.task_owner.get_full_name }}"
                                   disabled>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-4">
            <div class="card card-accent-danger" id="details">

                <div class="card-header">
                    <strong>Contact Detail</strong>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tbody>
                        <tr>
                            <th>Name</th>
                            <td>: <span>{{ task.contact.get_full_name }}
                            </span></td>
                        </tr>
                        <tr>
                            <th>company</th>
                            <td>: <span>
                            {{ task.contact.company }}</span></td>
                        </tr>
                        <tr>
                            <th>Phone</th>
                            <td>: <span>{{ task.contact.phone }}</span></td>
                        </tr>
                        <tr>
                            <th>Address</th>
                            <td>: <span>{{ task.contact.get_address }}
                            </span></td>
                        </tr>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <!--Task Modal -->
    <div class="modal fade" tabindex="-1" role="dialog" id="task-edit"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <form method="post"> {% csrf_token %}
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit Task</h5>
                        <button type="button" class="close" data-dismiss="modal"
                                aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Subject *</label>
                            <input type="text" class="form-control" name="task"
                                   value="{{ task }}">
                        </div>

                        <div class="form-group">
                            <label>Due Date *</label>
                            <input type="date" class="form-control"
                                   name="due_date"
                                   value="{{ task.due_date|date:"Y-m-d" }}">
                        </div>

                        <div class="form-group">
                            <label>Task Description</label>
                            <textarea rows="2" class="form-control"
                                      id="task-description"
                                      name="task_desc">{{ task.task_description }}</textarea>
                        </div>

                        <div class="row">
                            <div class="form-group col-sm-6">
                                <label>Priority</label>
                                <select class="select form-control"
                                        name="priority">
                                    <option value="{{ task.priority }}">
                                        {{ task.get_priority_display }}</option>
                                    <option value="0">Low</option>
                                    <option value='1'>Medium</option>
                                    <option value='2'>High</option>
                                </select>
                            </div>

                            <div class="form-group col-sm-6">
                                <label>Status</label>
                                <select class="form-control" name="task_status">
                                    <option value="{{ task.task_status }}">
                                        {{ task.get_task_status_display }}
                                    </option>
                                    <option value='1'>Completed</option>
                                    <option value='2'>Failed</option>
                                </select>

                            </div>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">
                            Save Changes
                        </button>
                        <button type="button" class="btn btn-secondary"
                                data-dismiss="modal">Close
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- End Task Modal -->



{% endblock %}

{% block script %}
    <script>
        {#$(".select option").val(function (idx, val) {#}
        {#    $(this).siblings("[value='" + val + "']").remove();#}
        //}//);

        var map = {};
        $('.select option').each(function () {
            if (map[this.value]) {
                $(this).remove()
            }
            map[this.value] = true;
        })
    </script>

{% endblock %}